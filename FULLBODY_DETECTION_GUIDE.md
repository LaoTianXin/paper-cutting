# 🚶 全身检测功能 - 使用指南

## 🎯 功能介绍

全身检测模式可以识别视频中的完整人体，使用 Haar Cascade Full Body 分类器进行检测。

### ✨ 特点

- ✅ 检测完整人体
- ✅ 支持多人同时检测
- ✅ 实时标记人体位置
- ✅ 显示检测人数统计
- ✅ 绿色框标记检测结果
- ✅ FPS 实时显示

---

## 🚀 快速开始

```bash
# 启动应用
pnpm dev

# 访问
http://localhost:3000
```

### 使用步骤

1. 点击顶部 **"🚶 全身检测"** 按钮
2. 点击 **"🎬 上传视频检测全身"**
3. 选择视频文件（推荐包含人物全身的视频）
4. 点击 **"▶️ 播放检测"**
5. 观看实时检测结果

---

## 🎬 最佳视频建议

### 推荐视频特征

```
✅ 人物全身在画面内
✅ 清晰的人物轮廓
✅ 光线充足
✅ 背景相对简单
✅ 人物站立或行走
✅ 分辨率 480p-720p
✅ 时长 10-30 秒
✅ 格式 MP4
```

### 不推荐的视频

```
❌ 只有上半身或脸部特写
❌ 人物被严重遮挡
❌ 光线太暗
❌ 背景过于复杂
❌ 人物运动过快
❌ 分辨率过高（>1080p）
```

---

## 📊 界面说明

### 主界面布局

```
┌────────────────────────────────────────┐
│         🎬 上传视频检测全身            │
├────────────────────────────────────────┤
│  ▶️ 播放检测 │ 🔄 重新开始 │ 🎯 FPS: 18│
├──────────────────┬─────────────────────┤
│   原始视频       │    检测结果         │
│   [视频播放]     │   [实时检测]        │
└──────────────────┴─────────────────────┘
```

### 统计卡片

```
┌──────────────────┬──────────────────┐
│  👥 检测到的人数 │  ⚡ 处理速度     │
│     2 人         │    18 FPS        │
└──────────────────┴──────────────────┘
```

### 检测标记

- **绿色矩形框**：标记检测到的人体
- **标签**：显示 "Body 1", "Body 2" 等
- **顶部统计**：显示 "Detected: X people"

---

## ⚙️ 技术参数

### 检测算法
- **模型**：haarcascade_fullbody.xml
- **算法**：Haar Cascade Classifier
- **窗口大小**：24x24 扫描窗口
- **最小尺寸**：50x100 像素

### 检测参数

```typescript
scaleFactor: 1.05    // 图像缩放因子（较小=更准确但更慢）
minNeighbors: 3      // 最小邻居数（较低=更多检测）
minSize: (50, 100)   // 最小人体尺寸（宽x高）
```

### 性能指标

| 指标 | 值 |
|-----|---|
| 目标帧率 | 20 FPS |
| 实际帧率 | 15-25 FPS（取决于设备和视频） |
| CPU 占用 | 30-50% |
| 内存占用 | ~80MB |
| 模型大小 | ~1.5MB |

---

## 💡 使用技巧

### 获得最佳检测效果

1. **视频质量**
   - 使用清晰的视频
   - 确保人物完整可见
   - 避免剧烈抖动

2. **光线条件**
   - 光线均匀充足
   - 避免强烈逆光
   - 避免阴影过重

3. **人物姿态**
   - 站立姿态最佳
   - 行走也可以检测
   - 避免坐着或躺着（检测率低）

4. **背景环境**
   - 简单背景效果更好
   - 避免复杂纹理
   - 避免背景中有类似人形的物体

### 性能优化

```
推荐配置：
📹 分辨率：640x480 或 1280x720
⏱️ 时长：≤ 30 秒
💾 格式：MP4 (H.264)
🎯 帧率：原视频 24-30 FPS

如果卡顿：
1. 降低视频分辨率
2. 减少视频时长
3. 使用更简单的背景
4. 关闭其他程序
```

---

## 🔍 检测原理

### Haar Cascade 全身检测流程

```
1. 输入视频帧
   ↓
2. 转换为灰度图
   ↓
3. 多尺度扫描
   ├─ 原始大小
   ├─ 缩小 1.05x
   ├─ 缩小 1.05²x
   └─ ...
   ↓
4. 在每个尺度应用级联分类器
   ├─ 阶段1：快速排除
   ├─ 阶段2：中等筛选
   └─ 阶段N：最终确认
   ↓
5. 合并重叠检测
   ↓
6. 绘制检测框
```

### 特征检测

Haar Cascade 检测以下身体特征：
- 头部轮廓
- 肩膀宽度
- 躯干形状
- 腿部轮廓
- 整体人形比例

---

## 📈 检测准确率

### 影响因素

| 因素 | 影响程度 | 说明 |
|-----|---------|------|
| 姿态 | ⭐⭐⭐⭐⭐ | 站立>行走>坐着 |
| 光线 | ⭐⭐⭐⭐ | 充足均匀光线最佳 |
| 背景 | ⭐⭐⭐ | 简单背景效果更好 |
| 分辨率 | ⭐⭐⭐ | 太低或太高都不好 |
| 距离 | ⭐⭐⭐ | 中距离最佳 |

### 典型场景准确率

```
✅ 理想场景（站立、光线好、简单背景）：80-90%
✅ 一般场景（行走、正常光线）：60-80%
⚠️ 较差场景（坐着、复杂背景）：30-60%
❌ 极差场景（躺着、很暗、遮挡）：<30%
```

---

## 🆚 与其他检测模式对比

### 全身 vs 人脸检测

| 特性 | 全身检测 | 人脸检测 |
|-----|---------|---------|
| 检测对象 | 完整人体 | 面部 |
| 检测速度 | 较慢 | 快 |
| 准确率 | 中等 | 高 |
| 最小尺寸要求 | 50x100 像素 | 24x24 像素 |
| 适用距离 | 中远距离 | 近距离 |
| 姿态要求 | 站立/行走 | 正面 |

### 全身 vs 手势识别

| 特性 | 全身检测 | 手势识别 |
|-----|---------|---------|
| 技术 | Haar Cascade | MediaPipe |
| 检测对象 | 整个人体 | 手部 |
| 关键点 | 无 | 21个 |
| 准确率 | 中等 | 高 |
| 资源占用 | 中等 | 中高 |
| 适用场景 | 人群统计 | 交互应用 |

---

## 🎯 应用场景

### 适合的应用

1. **人数统计**
   - 商场客流统计
   - 会议人数统计
   - 公共场所监控

2. **安全监控**
   - 区域入侵检测
   - 人员跟踪
   - 异常行为监测

3. **体育分析**
   - 运动员追踪
   - 比赛人员统计
   - 动作分析辅助

4. **视频分析**
   - 视频内容分析
   - 人物出现统计
   - 场景理解

### 局限性

```
❌ 不适合：
- 面部识别（用人脸检测）
- 手势识别（用手势检测）
- 姿态估计（需要深度学习模型）
- 动作识别（需要时序分析）
- 身份识别（需要特征提取）
```

---

## 🐛 常见问题

### Q1: 检测不到人？

**可能原因**：
- 人物不完整在画面内
- 人物太小或太大
- 姿态不是站立/行走
- 光线太暗
- 被遮挡

**解决方案**：
- 确保全身在画面内
- 调整拍摄距离
- 让人物站立
- 改善光线
- 避免遮挡物

### Q2: 误检测（非人物被识别）？

**可能原因**：
- 背景中有类人形物体
- 光影形成人形轮廓
- 检测参数过于宽松

**解决方案**：
- 简化背景
- 改善光线条件
- 调整检测参数（代码中修改）

### Q3: 处理速度很慢？

**原因**：
- 视频分辨率过高
- 视频时长过长
- 设备性能不足

**解决方案**：
- 降低视频分辨率到 720p
- 剪短视频到 30 秒内
- 关闭其他占用资源的程序
- 压缩视频文件

### Q4: 同一个人被检测多次？

**原因**：
- 检测框重叠合并不够完善
- 人物部分被遮挡

**说明**：
- 这是正常现象
- Haar Cascade 的固有限制
- 如需精确追踪，建议使用深度学习方法

---

## 🔧 高级调整

### 调整检测参数

如需调整检测敏感度，修改 `src/fullBodyDetection.ts`：

```typescript
fullBodyCascade.detectMultiScale(
  gray,
  bodies,
  1.05,  // scaleFactor: 值越小检测越细致但越慢
  3,     // minNeighbors: 值越大误检越少但可能漏检
  0,
  new cv.Size(50, 100),  // minSize: 最小身体尺寸
  msize  // maxSize: 最大尺寸（当前未限制）
);
```

### 参数说明

| 参数 | 默认值 | 调整建议 |
|-----|-------|---------|
| scaleFactor | 1.05 | 1.03-1.1，越小越准确但越慢 |
| minNeighbors | 3 | 2-5，越大误检越少 |
| minSize.width | 50 | 根据视频调整 |
| minSize.height | 100 | 根据视频调整 |

---

## 📚 扩展功能建议

### 可以添加的功能

1. **人数统计图表**
   ```typescript
   - 时间线上的人数变化
   - 最大/最小/平均人数
   - 人数热力图
   ```

2. **区域检测**
   ```typescript
   - 设置感兴趣区域（ROI）
   - 只统计特定区域内的人
   ```

3. **导出功能**
   ```typescript
   - 导出标注后的视频
   - 导出统计数据（CSV）
   - 截图保存
   ```

4. **实时告警**
   ```typescript
   - 人数超过阈值时告警
   - 检测到入侵时提示
   ```

---

## 🎓 学习资源

### OpenCV 相关
- [Haar Cascade 原理](https://docs.opencv.org/3.4/db/d28/tutorial_cascade_classifier.html)
- [目标检测教程](https://docs.opencv.org/master/d7/d8b/tutorial_py_face_detection.html)

### 模型训练
- [训练自己的 Haar Cascade](https://docs.opencv.org/3.4/dc/d88/tutorial_traincascade.html)
- [正负样本准备](https://docs.opencv.org/master/dc/d88/tutorial_traincascade.html)

---

## 🎉 总结

全身检测功能是 AI 视觉检测平台的重要组成部分，适用于：
- ✅ 人数统计
- ✅ 区域监控
- ✅ 视频分析
- ✅ 人群追踪

结合其他检测模式，可以构建完整的视觉识别解决方案！

---

## 🚀 开始使用

```bash
pnpm dev
```

访问 http://localhost:3000，点击 **"🚶 全身检测"** 开始体验！

祝你使用愉快！🎊

